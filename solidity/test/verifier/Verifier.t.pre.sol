// SPDX-License-Identifier: UNLICENSED
// This is licensed under the Cryptographic Open Software License 1.0
pragma solidity ^0.8.28;

import {Test} from "forge-std/Test.sol";
import "./../../src/base/Constants.sol";
import {Errors} from "./../../src/base/Errors.sol";
import {Verifier} from "./../../src/verifier/Verifier.pre.sol";

contract VerifierTest is Test {
    function verify(
        bytes calldata result,
        bytes calldata plan,
        bytes calldata proof,
        uint256[] memory tableLengths,
        uint256[] memory commitments
    ) public view {
        Verifier.__verify({
            __result: result,
            __plan: plan,
            __proof: proof,
            __tableLengths: tableLengths,
            __commitments: commitments
        });
    }

    function testSimpleFull() public view {
        uint256[] memory tableLengths = new uint256[](1);
        tableLengths[0] = 6;
        uint256[] memory commitments = new uint256[](4);
        commitments[0] = 10330259091102222580680469239495014349163118537637164875615751892418606990939;
        commitments[1] = 11920476268597659993223945595713248355766624440856258163660132291159882440306;
        commitments[2] = 11994260765248910561540716452031502208136256599213361935879450273410509855704;
        commitments[3] = 13760418268827664034425846360177624835399216842325030254024970295997593510876;
        Verifier.__verify({
            __result: hex"00000000000000010000000000000001620000000000000000000000000200000000000000000000000000000003",
            __plan: hex"0000000000000001000000000000000f6e616d6573706163652e7461626c650000000000000002000000000000000000000000000000016200000005000000000000000000000000000000016100000005000000000000000100000000000000016200000000000000000000000000000002000000000000000000000001000000010000000000000000000000050000000000000001000000000000000000000000",
            __proof: hex"0000000000000006000000000000000200000000000000010000000000000002000000000000000000000000000000000000000000000006000000000000000527a607595971e4f8531109d6bcf114838faac36652aa81d86d51f087cd08799c1095fa761ceaceb796068f4b8174492ede1e88c2f4aafee493331c267284be330078dfd5227feba93faa9a0c9c38432d6c169909d2546f8cef0b7a2108d44db71d518c19207b5ee92cca5cfe09ec5aca67af638b4205a7b650ccb9b9ecd6dd81236cd1dd5ae57dd08a8b09bd6bd3397fe4b58aa1638c554b8054dcb2d4d0297e12a7e3d2a6d11cf4e66979ea5458d24f66ba7866c43b933fd2135c2a7619901421bafb7fa626cef41c7cfe9a1b6f9037b676b372cdc89068d564807164469d950d52f9b3eb6e6128dfecdb6d6915a73443dbd1cd15ef1885ebf2a77020661db91019be6190534138bb86202e23f697bf2a9fd3f84f30e153c4253955f92055c8163b3accc834e159bf6cbb24c328d8d89773f92a3c7c2a12da75218760f529ef0000000000000000000000000000000c068d725c6aa96e9a6a3c862c8a92392d6c5282e0003c75200c87c3b996375aca165d1d77672ebfeb20d9d3700b7730d92517e7665d55404d1a987e2e8719075b1379be9f0f5971a42d39ec19eb77ee5696c97e021c27bb241cc1b3abd2af9ddc00000000000000000000000000000000000000000000000000000000000000001d394546873afebd15fdb34bec3308bac5810509c08630100f1cde9911ab01b419505408531ca5b9495c0aa6fade3450a95c202e9aee4ee35181c5ba5931620f0057ab5fe15df0e1f0187f42adec8a0d9d2b6c388f00373493c5e58f3d5f420311c29a942b2ecd24a17f58d8c10b8aafa54cdd795cc3a7a395aa39971dcfa320141784a4800c5106dab9f212642ab11b4cec11e320a6ed0ddbe8c1c6bf6d215f24bc9019f642c345c255f5113962f1293bf475812328e8b804fa6adbc32cca100cee4a04d8c164f2aa0b75340cab3b41d4c0b112ac6d7f998acc0c703f3790520b4ac6bbc4df811678249fcc218922026e52af4d2a52465404e5cdc4d1f5777a000000000000000000000000000000022076c88c581575faa3f26058e6b530d61c8a2a03317487384c4931ff960979a923bfded74d10e7d5813c66582c29e5446df0400590f692fe048abb4fb2f9a37f0000000000000005018313adcf1d66802022bdd9fa9ed84be64f437506759c382a6e4d43fd206f892fad82f122818fe5d3dc6342d061ab4ce41f179452ec661d9d54e03e46bf40251c23c1fd3b0ceda77665498137001fdf908b8e61a87ac4ae6e85974eb3c1c2480e9c75ae36c89274e2bc68bb88cce3db06e3c73ef723c576120d1250231501712b65c2188d6f4865b789fd26b5f86e2412097b0d99b2d2e181f1639ae2f27b700000000000000002189894761542c2703b4d06ff534e0ca3f1bfc534f02c963f82408869c143f6e0268537eaa24b7edc9aef3ed46c614a619b836a684e7bd3b62e4c2c5111f2b78d0870bd1eafe417bbe7390c12f12952b1e36951c60347cca17400d4720670325d200477d280991e3bcbf63fcb205fb87a41b1ed425566041237df0d1d3846b2f200000000000000032a529ade53367fc3520120e315bd3fab8eaf9ed3311f5d4e78ea5f2118b327a9171a19a682edc88bb324212ed2503c23e9d9b0af736334ad41ba27a41827b12c2882d9f29ae5df5dd63f2fb570be666524deabd119ef7e0e55555c5d673d8d9d0949158378a23f5fb2e352b16f98e16c1a50d83955af006d2c456df4b9355a380c23be8cfabd4c8e012c1e60d7a5afc9c5ea1242edeebb06cbcdcf584060e1ff189197ba5a06f23833d87c9a99907053d2ab37b798f72d21bbededea7d9863f12d7768d706fde86f241add6b28822addc862344a441ff8dbf84eb90ea40ef3b2052059e5c77a06e57a0ccc5e40a61b186b4ab97481d593dea64fe709317e15f4221724fb8baba4a820705db0183bb643d74738489bc0d3b0709fc876fb8827272f1cd0a54b9b6668b30ef2c59491a05acd18d210006eb0f2f6c6335b15d8110805c66e96bd019229096ccee6a0ecd7d5e9348b7de17014f58cec046ce4682a8c0335f3d0f58fb5c9842e632665db96361ebf5a0ceb4ac27bfc8e155b81c6ddc417b1adbefc9765a6182269d49bf98f73b69d4c55c9034cd6bd9785c35444468e13b25c29d2da831c2cf95292d1efa66a4bbeafdcb799802fc87e027c6de91b072f5362e3e4f676f1915a9f0d9bd3f33bf6aad1e79270aaed7a6e777d1055396a",
            __tableLengths: tableLengths,
            __commitments: commitments
        });
    }

    function testCommitmentArrayOddLength() public {
        uint256[] memory tableLengths = new uint256[](1);
        tableLengths[0] = 6;

        // Create an array with an odd length (5 elements)
        uint256[] memory commitments = new uint256[](5);
        commitments[0] = 10330259091102222580680469239495014349163118537637164875615751892418606990939;
        commitments[1] = 11920476268597659993223945595713248355766624440856258163660132291159882440306;
        commitments[2] = 11994260765248910561540716452031502208136256599213361935879450273410509855704;
        commitments[3] = 13760418268827664034425846360177624835399216842325030254024970295997593510876;
        commitments[4] = 12345678901234567890123456789012345678901234567890123456789012345678901234567; // Add extra element

        // Expect the error for odd-length commitment array
        vm.expectRevert(Errors.CommitmentArrayOddLength.selector);

        Verifier.__verify({
            __result: hex"00",
            __plan: hex"00",
            __proof: hex"00",
            __tableLengths: tableLengths,
            __commitments: commitments
        });
    }
}
